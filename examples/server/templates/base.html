{% load active djangular_tags %}
<!doctype html>
<html lang="en">
<head>
	<title>Django-Angular Demo</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
	<link href="{{ STATIC_URL }}css/djangular-demo.css" rel="stylesheet" />
</head>
<body ng-app="djangular-demo">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="brand" href="/">Djangular Demo</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="{% active request 'djng_form_validation' %}">
							<a href="{% url 'djng_form_validation' %}">Form Validation</a>
						</li>
						<li class="{% active request 'djng_model_form' %}">
							<a href="{% url 'djng_model_form' %}">Model Form</a>
						</li>
						<li class="{% active request 'djng_model_form_validation' %}">
							<a href="{% url 'djng_model_form_validation' %}">Model Form Validation</a>
						</li>
						{% if WEBSOCKET_URI %}
						<li class="{% active request 'djng_3way_databinding' %}">
							<a href="{% url 'djng_3way_databinding' %}">Three-Way Data-Binding</a>
						</li>
						{% endif %}
						<li class="{% active request 'djng_partial_home' %} dropdown">
							<a href="{% url 'djng_partial_home' %}" class="dropdown-toggle">Partials <b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li>
									<a href="{% url 'djng_partial_home' %}/contacts">Contacts</a>
								</li>
								<li>
									<a href="{% url 'djng_partial_home' %}/about">About</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div class="container">
		{% block container %}
		<div class="row">
			{% block subscribe_me_form %}{% endblock subscribe_me_form %}
		</div>
		{% endblock container %}
	</div>
	<div ui-sref="self"></div>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.js" type="text/javascript"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap-tpls.min.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/ng-django-forms.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/ng-django-websocket.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/angular-ui-router.js" type="text/javascript"></script>
	<script src="{{ STATIC_URL }}js/djangular-router.js" type="text/javascript"></script>
	<script type="text/javascript">
	{% block scripts %}
	var my_app = angular.module('djangular-demo', ['ui.bootstrap', 'djangular.router', 'ng.django.forms', 'ng.django.websocket']);
	my_app.config(function($locationProvider, $urlRouterProvider, $stateProvider) {
		$locationProvider.html5Mode(true);
		$urlRouterProvider.rule(function($injector, $location) {
			var $window, $state, urlMatcher, match = false;
			console.log('rule');
			console.log($location.search());
			$injector.invoke(['$window', '$state', '$urlMatcherFactory', function(w, s, u) {
				$window = w;
				$state = s;
				urlMatcher = u.compile('{% djng_canonical_url %}');
			}]);
			angular.forEach($state.get(), function(state) {
				// if current URL matches with URL from named state, transition to that state
				if ($location.path() === state.url) {
					$state.go(state.name);
					match = true;
					console.log('matched');
				}
			});
			if (!match && !urlMatcher.exec($location.path())) {
				// redirect on other URL
				console.log('redirect');
				$window.location.assign($location.path());
			}
			return false;
			return $location.path();
		});
		$stateProvider.initialize({});
	});
	{% endblock scripts %}
	</script>
</body>
</html>
